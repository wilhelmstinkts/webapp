<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/form.css">

  <meta name="theme-color" content="#fafafa">
  <script type="text/javascript" src="js/services/locationService.js"></script>
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
  <form id="form" onsubmit="return false">
    <div class="formRow">
      <input type="text" style="flex:1;" name="givenName" placeholder="Vorname" required=true minlength="2" />
      <input type="text" style="flex:2;" name="surname" placeholder="Nachname" required=true minlength="2" />
    </div>
    <div class="formRow">
      <input type="email" style="width: 100%;" name="eMail" placeholder="E-Mailadresse" required=true minlength="2" />
    </div>
    <div class="formRow">
      <input type="text" id="inputStreet" style="flex:3;" name="street" placeholder="Straße" required=true
        minlength="2" />
      <input type="text" id="inputNumber" style="flex:1;" name="number" placeholder="Hausnummer" required=true />
    </div>
    <button id="buttonPositiontoggle" name="notAdress" type="button" onclick="getLocation()">Meine Position
      verwenden</button>
    <p id="positionDisplay" hidden></p>
    <br>
    <select onchange="showDiverse()" id="selectFlavor" name="kind" placeholder="Wonach stinkt es?" required>
      <option value="" disabled selected hidden>Wonach stinkt es?</option>
      <option>Kaffee</option>
      <option>Schokolade</option>
      <option>Bäckerei</option>
      <option>Biomüll</option>
      <option>Lack</option>
      <option>Sonstiges</option>
    </select>
    <div class="formRow">
      <input type="text" id="inputDiverse" placeholder="Bitte Geruch beschreiben" style="width: 40em;" hidden />
    </div>
    <div class="formRow">
      <input style="flex:1;" type="range" min="1" max="5" name="intensity">
      <label style="flex:1;" for="intensity">Intensität</label>
    </div>
    <div class="formRow">
      <input type="checkbox" style="flex: 1;" name="checkConsent" required=true> <label style="flex: 20;"
        for="checkConsent"> Ich bin damit einverstanden,
        dass meine eingegebenen Daten an die Senatsverwaltung für blablabla gesendet werden.</label>
    </div>
    <button type="submit" onclick="sendForm()">Senden</button>
    <p id="submitStatus" hidden></p>
  </form>

</body>
<script>
  async function sendForm() {
    var form = document.getElementById("form");
    var submitStatus = document.getElementById("submitStatus");
    submitStatus.removeAttribute("hidden", "");
    var statusMessage = "";

    if (form.checkValidity()) {
      let address;
      if (coordinates === undefined) {
        address = {
          country: "Germany",
          city: "Berlin",
          zip: "13158",
          street: document.getElementById("inputStreet").value,
          number: document.getElementById("inputNumber").value
        };
        coordinates = await LocationService.getCoordinatesForAddress(address);
        console.log(coordinates);
      }

      statusMessage = "Server nicht erreichbar. Bitte versuch es später noch einmal.";
    }
    else {
      statusMessage = "Bitte prüfe deine Angaben.";
    }
    submitStatus.innerText = statusMessage;
  }

  var positionDisplay = document.getElementById("positionDisplay");
  let coordinates;

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(saveAndshowPosition);
      document.getElementById("inputStreet").setAttribute("hidden", "true");
      document.getElementById("inputNumber").setAttribute("hidden", "true");
      document.getElementById("inputStreet").removeAttribute("required", "");
      document.getElementById("inputNumber").removeAttribute("required", "");
      var toggleButton = document.getElementById("buttonPositiontoggle");
      toggleButton.innerText = "Adresse eingeben";
      toggleButton.onclick = showAdress;


    } else {
      positionDisplay.innerHTML = "Dein Browser unterstützt keine Ortung.";
    }
  }

  function saveAndshowPosition(position) {
    coordinates = position.coords;
    positionDisplay.removeAttribute("hidden", "");
    positionDisplay.innerHTML = "Deine Position: <br />"
      + position.coords.latitude.toLocaleString('de-DE', { maximumFractionDigits: 5 }) + "° Breite <br />"
      + position.coords.longitude.toLocaleString('de-DE', { maximumFractionDigits: 5 }) + "° Länge";
  }

  function showAdress() {
    positionDisplay.setAttribute("hidden", true);
    document.getElementById("inputStreet").removeAttribute("hidden", "");
    document.getElementById("inputNumber").removeAttribute("hidden", "");
    document.getElementById("inputStreet").setAttribute("required", "");
    document.getElementById("inputNumber").setAttribute("required", "");
    var toggleButton = document.getElementById("buttonPositiontoggle");
    toggleButton.innerText = "Meine Position verwenden";
    toggleButton.onclick = getLocation;
  }

  function showDiverse() {
    var inputDiverse = document.getElementById("inputDiverse");
    var selection = document.getElementById("selectFlavor").value;
    if (selection == "Sonstiges") {
      inputDiverse.removeAttribute("hidden");
      inputDiverse.setAttribute("required", "");
    }
    else {
      inputDiverse.removeAttribute("required");
      inputDiverse.setAttribute("hidden", "");
    }

  }
</script>


</html>